@inherits Umbraco.Web.Macros.PartialViewMacroPage

@{
    var root = CurrentPage.AncestorOrSelf(1);
    var Project = CurrentPage.AncestorOrSelf(1).Children.Where("DocumentTypeAlias == \"ProjectsMain\"").First();
}

<li class="@(CurrentPage.Name == root.Name ? "active" : null)">
    <a href="/">@root.Name</a>
</li>
@foreach (var menuItem in root.Children.Where("Visible"))
{
    var isProtected = umbraco.library.IsProtected(menuItem.Id, menuItem.path);
    var loginAccess = umbraco.library.IsProtected(menuItem.id, menuItem.path) && umbraco.library.HasAccess(menuItem.id, menuItem.path);

    if (!isProtected || loginAccess)
    {
        <li class="@(menuItem.IsAncestorOrSelf(CurrentPage) ? "active" : null)">
            <a href="@menuItem.Url">@menuItem.Name</a>
        </li>
    }
}

<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Our Projects <span class="caret"></span></a>
    <ul class="dropdown-menu">
        @foreach (var project in Project.Children.Where("Visible"))
        {
            var isProtected = umbraco.library.IsProtected(project.id, project.path);
            var loginAccess = umbraco.library.IsProtected(project.id, project.path) && umbraco.library.HasAccess(project.id, project.path);
            if (Umbraco.GetPreValueAsString(project.projectStatus) == "Completed" && !isProtected || loginAccess)
            {
                <li>
                    <a href="@project.Url">@project.Name</a>
                </li>
            }
        }
    </ul>
</li>